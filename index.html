<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üê∏ Sapich√µes Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:'Fredoka One', sans-serif; background:#dfffd6; color:#2e7d32; text-align:center; }
header { background:#66bb6a; color:white; padding:15px; font-size:28px; font-weight:bold; position:relative; }
#mascote { position:absolute; right:15px; top:0; height:60px; }
button { padding:12px 25px; margin:10px; border:none; border-radius:10px; background:#43a047; color:white; font-size:18px; cursor:pointer; transition:0.2s; }
button:hover { background:#2e7d32; transform:scale(1.05);}
input, select { padding:10px; margin:5px; border-radius:8px; font-size:16px; }
#telaInicial, #hostTela, #playerTela, #perguntaArea, #ranking { margin-top:20px; }
#ranking p { font-size:20px; font-weight:bold; }
.medalha { font-size:28px; margin-right:10px; }
#timer { font-size:28px; color:#ff6f00; font-weight:bold; margin-top:10px; }
.feedback { font-size:22px; font-weight:bold; margin-top:10px; }
.acerto { color:green; }
.erro { color:red; }
@media(max-width:600px){ button,input,select{width:80%; font-size:16px;} header{font-size:24px;} #timer{font-size:24px;} #mascote{height:50px;} }
</style>
</head>
<body>

<header>üê∏ Sapich√µes Quiz
<img id="mascote" src="https://i.imgur.com/2aR9h1A.png" alt="Mascote Sapo">
</header>

<div id="telaInicial">
  <button onclick="mostrarTela('host')">Criar Jogo</button>
  <button onclick="mostrarTela('player')">Entrar no Jogo</button>
</div>

<div id="hostTela" style="display:none">
  <h2>Escolha a categoria:</h2>
  <select id="categoria"></select><br>
  <button onclick="criarJogo()">Criar Partida</button>
  <p id="pin"></p>
  <div id="lobby"></div>
  <button onclick="iniciarJogo()">Iniciar Jogo</button>
  <div id="perguntaArea" style="display:none">
    <div id="pergunta"></div>
    <div id="opcoes"></div>
    <div id="timer"></div>
    <div id="feedback" class="feedback"></div>
  </div>
</div>

<div id="playerTela" style="display:none">
  <div id="pinDiv">
    <input type="number" id="pinInput" placeholder="PIN da partida"><br>
  </div>
  <input type="text" id="nome" placeholder="Seu nome"><br>
  <button onclick="entrar()">Entrar</button>
  <div id="perguntaAreaPlayer" style="display:none">
    <div id="perguntaPlayer"></div>
    <div id="opcoesPlayer"></div>
    <div id="timerPlayer"></div>
    <div id="feedbackPlayer" class="feedback"></div>
  </div>
</div>

<div id="ranking" style="display:none"></div>

<script>
const FIREBASE_URL = "https://sapichoes1-default-rtdb.firebaseio.com/";

const perguntas = {
  "matematica":[
    {pergunta:"Quanto √© 7 x 8?", opcoes:["54","56","64","48"], correta:1},
    {pergunta:"Raiz quadrada de 81?", opcoes:["7","8","9","10"], correta:2}
  ],
  "portugues":[
    {pergunta:"Plural de 'c√£o'?", opcoes:["c√µes","c√£os","c√£es","caos"], correta:2}
  ],
  "historia":[
    {pergunta:"Ano da Independ√™ncia do Brasil?", opcoes:["1822","1889","1500","1808"], correta:0}
  ],
  "geografia":[
    {pergunta:"Maior pa√≠s do mundo?", opcoes:["China","R√∫ssia","Brasil","Canad√°"], correta:1}
  ],
  "artes":[
    {pergunta:"Quem pintou a Mona Lisa?", opcoes:["Van Gogh","Da Vinci","Picasso","Monet"], correta:1}
  ]
};

let pinGerado, categoriaEscolhida, perguntaIndex=0;
let nome="", pontos=0;
let tempo=15, timerInterval=null;

// Telas
function mostrarTela(tela){
  document.getElementById("telaInicial").style.display="none";
  document.getElementById("hostTela").style.display = (tela==='host') ? "block" : "none";
  document.getElementById("playerTela").style.display = (tela==='player') ? "block" : "none";
  if(tela==='host'){
    const select = document.getElementById("categoria");
    select.innerHTML="";
    Object.keys(perguntas).forEach(cat=>{
      const option = document.createElement("option");
      option.value=cat;
      option.textContent=cat.charAt(0).toUpperCase()+cat.slice(1);
      select.appendChild(option);
    });
  }
}

// Criar partida
function criarJogo(){
  categoriaEscolhida = document.getElementById("categoria").value;
  pinGerado = Math.floor(100000 + Math.random()*900000);
  document.getElementById("pin").innerText = "PIN: "+pinGerado;
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json', {
    method:'PUT',
    body: JSON.stringify({categoria:categoriaEscolhida, perguntaIndex:0, jogadores:{}})
  }).then(()=> atualizarLobby());
}

// Lobby
function atualizarLobby(){
  const lobby = document.getElementById("lobby");
  setInterval(()=>{
    fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores.json')
    .then(r=>r.json())
    .then(data=>{
      lobby.innerHTML="<h3>Jogadores no lobby:</h3>";
      if(data) Object.keys(data).forEach(j=> lobby.innerHTML+="<p>"+j+"</p>");
    });
  },1000);
}

// Iniciar jogo
function iniciarJogo(){
  perguntaIndex=0;
  atualizarPerguntaHost();
}

// Atualizar pergunta host
function atualizarPerguntaHost(){
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json')
  .then(r=>r.json())
  .then(game=>{
    if(!game) return;
    if(perguntaIndex>=perguntas[categoriaEscolhida].length){ mostrarRankingFinal(); return; }
    tempo=15;
    const p = perguntas[categoriaEscolhida][perguntaIndex];
    const divO = document.getElementById("opcoes");
    const divP = document.getElementById("pergunta");
    const feedback = document.getElementById("feedback");
    divP.innerText = p.pergunta;
    feedback.innerText = "";
    divO.innerHTML="";
    p.opcoes.forEach((op,i)=>{
      const btn = document.createElement("button");
      btn.innerText = op;
      btn.onclick = ()=>responderHost(i);
      divO.appendChild(btn);
    });
    document.getElementById("perguntaArea").style.display="block";
    iniciarTimerHost();
  });
}

// Timer Host
function iniciarTimerHost(){
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    document.getElementById("timer").innerText = "‚è± "+tempo+"s";
    tempo--;
    if(tempo<0){
      clearInterval(timerInterval);
      perguntaIndex++;
      fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json', {
        method:'PATCH',
        body: JSON.stringify({perguntaIndex})
      }).then(()=> atualizarPerguntaHost());
    }
  },1000);
}

// Host responde
function responderHost(opIndex){
  clearInterval(timerInterval);
  const p = perguntas[categoriaEscolhida][perguntaIndex];
  const feedback = document.getElementById("feedback");
  feedback.innerText = (opIndex===p.correta) ? "‚úÖ Acertou!" : "‚ùå Errou!";
  feedback.className = "feedback " + ((opIndex===p.correta) ? "acerto" : "erro");
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores.json')
  .then(r=>r.json())
  .then(data=>{
    if(data){
      Object.keys(data).forEach(j=>{
        let pts = data[j].pontos || 0;
        if(opIndex===p.correta) pts += 10 + tempo;
        fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores/'+j+'.json', {
          method:'PATCH',
          body: JSON.stringify({pontos:pts})
        });
      });
    }
    perguntaIndex++;
    fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json', {
      method:'PATCH',
      body: JSON.stringify({perguntaIndex})
    }).then(()=> setTimeout(atualizarPerguntaHost, 1000));
  });
}

// Player entra
function entrar(){
  nome = document.getElementById("nome").value;
  const pinInput = document.getElementById("pinInput").value;
  if(!nome || !pinInput){ alert("Digite PIN e nome!"); return; }
  pinGerado = pinInput;
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores/'+nome+'.json', {method:'PUT', body:JSON.stringify({pontos:0})})
  .then(()=>{
    document.getElementById("pinDiv").style.display="none";
    document.getElementById("playerTela").querySelector("button").style.display="none";
    atualizarPerguntaPlayer();
  });
}

// Atualizar pergunta player AO VIVO
function atualizarPerguntaPlayer(){
  const divO = document.getElementById("opcoesPlayer");
  const divP = document.getElementById("perguntaPlayer");
  const divT = document.getElementById("timerPlayer");
  const feedback = document.getElementById("feedbackPlayer");
  setInterval(()=>{
    fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json')
    .then(r=>r.json())
    .then(game=>{
      if(!game) return;
      categoriaEscolhida = game.categoria;
      perguntaIndex = game.perguntaIndex;
      if(perguntaIndex>=perguntas[categoriaEscolhida].length){ mostrarRankingFinal(); return; }
      const p = perguntas[categoriaEscolhida][perguntaIndex];
      divP.innerText = p.pergunta;
      feedback.innerText = "";
      divO.innerHTML="";
      p.opcoes.forEach((op,i)=>{
        const btn = document.createElement("button");
        btn.innerText=op;
        btn.onclick = ()=>responderPlayer(i);
        divO.appendChild(btn);
      });
      tempo = game.tempo || 15;
      divT.innerText = "‚è± "+tempo+"s";
      document.getElementById("perguntaAreaPlayer").style.display="block";
    });
  },1000);
}

// Player responde
function responderPlayer(opIndex){
  const feedback = document.getElementById("feedbackPlayer");
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores/'+nome+'.json')
  .then(r=>r.json())
  .then(data=>{
    let pts = data.pontos || 0;
    const p = perguntas[categoriaEscolhida][perguntaIndex];
    if(opIndex===p.correta){
      pts += 10 + tempo;
      feedback.innerText = "‚úÖ Acertou!";
      feedback.className = "feedback acerto";
    } else{
      feedback.innerText = "‚ùå Errou!";
      feedback.className = "feedback erro";
    }
    fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores/'+nome+'.json', {method:'PATCH', body:JSON.stringify({pontos:pts})});
  });
}

// Ranking final
function mostrarRankingFinal(){
  document.getElementById("perguntaArea").style.display="none";
  document.getElementById("hostTela").style.display="none";
  document.getElementById("playerTela").style.display="none";
  const divR = document.getElementById("ranking");
  divR.style.display="block";
  divR.innerHTML="<h2>üèÜ Ranking Final üèÜ</h2>";
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores.json')
  .then(r=>r.json())
  .then(data=>{
    const lista=[];
    if(data) Object.keys(data).forEach(j=> lista.push({nome:j, score:data[j].pontos}));
    lista.sort((a,b)=>b.score-a.score);
    lista.forEach((p,i)=>{
      let medalha="";
      if(i===0) medalha="ü•á";
      else if(i===1) medalha="ü•à";
      else if(i===2) medalha="ü•â";
      divR.innerHTML+="<p><span class='medalha'>"+medalha+"</span>"+p.nome+" - "+p.score+" pts</p>";
    });
  });
}
</script>

</body>
</html>

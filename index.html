<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¸ Quiz SapichÃµes AO VIVO</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Fredoka One',sans-serif;background:#dfffd6;color:#2e7d32;text-align:center;}
header{background:#66bb6a;color:white;padding:15px;font-size:28px;font-weight:bold;position:relative;}
#mascote{position:absolute;right:15px;top:0;height:60px;}
button{padding:12px 25px;margin:10px;border:none;border-radius:15px;background:#43a047;color:white;font-size:18px;cursor:pointer;transition:0.2s;box-shadow:0 4px 6px rgba(0,0,0,0.2);}
button:hover{background:#2e7d32;transform:scale(1.05);}
input,select{padding:10px;border-radius:10px;border:2px solid #2e7d32;font-size:18px;margin:5px;}
#telaInicial,#hostTela,#playerTela,#ranking{margin-top:20px;}
#ranking p{font-size:20px;font-weight:bold;}
.medalha{font-size:28px;margin-right:10px;}
#timer{font-size:28px;color:#ff6f00;font-weight:bold;margin-top:10px;}
.feedback{font-size:22px;font-weight:bold;margin-top:10px;}
.acerto{color:green;}
.erro{color:red;}
.opcaoBtn{display:block;width:90%;max-width:300px;margin:10px auto;}
.container{max-width:500px;margin:auto;}
@media(max-width:600px){button,input,select{width:80%;font-size:16px;}header{font-size:24px;}#timer{font-size:24px;}#mascote{height:50px;}}
</style>
</head>
<body>

<header>ğŸ¸ Quiz SapichÃµes
<img id="mascote" src="https://i.imgur.com/2aR9h1A.png" alt="Mascote Sapo">
</header>

<div class="container" id="telaInicial">
  <button onclick="mostrarTela('host')">ğŸ“ Criar Jogo</button>
  <button onclick="mostrarTela('player')">ğŸ® Entrar no Jogo</button>
</div>

<div class="container" id="hostTela" style="display:none">
  <h2>Escolha a categoria:</h2>
  <select id="categoria"></select><br>
  <button onclick="criarJogo()">ğŸ¯ Criar Partida</button>
  <p id="pin" style="font-size:22px;font-weight:bold;margin-top:10px;"></p>
  <div id="lobby"></div>
  <button onclick="iniciarJogo()">ğŸš€ Iniciar Jogo</button>
  <div id="perguntaArea" style="display:none">
    <div id="pergunta" style="font-size:22px;margin-top:15px;"></div>
    <div id="opcoes"></div>
    <div id="timer"></div>
    <div id="feedback" class="feedback"></div>
  </div>
</div>

<div class="container" id="playerTela" style="display:none">
  <div id="pinDiv">
    <input type="number" id="pinInput" placeholder="PIN da partida"><br>
  </div>
  <input type="text" id="nome" placeholder="Seu nome"><br>
  <button onclick="entrar()">ğŸ”‘ Entrar</button>
  <div id="perguntaAreaPlayer" style="display:none">
    <div id="perguntaPlayer" style="font-size:22px;margin-top:15px;"></div>
    <div id="opcoesPlayer"></div>
    <div id="timerPlayer"></div>
    <div id="feedbackPlayer" class="feedback"></div>
  </div>
</div>

<div class="container" id="ranking" style="display:none"></div>

<script>
const FIREBASE_URL = "https://sapichoes1-default-rtdb.firebaseio.com/";

// Perguntas de exemplo
const perguntas = {
  "matematica":[
    {pergunta:"Quanto Ã© 7 x 8?", opcoes:["54","56","64","48"], correta:1},
    {pergunta:"Raiz quadrada de 81?", opcoes:["7","8","9","10"], correta:2}
  ],
  "portugues":[
    {pergunta:"Plural de 'cÃ£o'?", opcoes:["cÃµes","cÃ£os","cÃ£es","caos"], correta:2}
  ],
  "historia":[
    {pergunta:"Ano da IndependÃªncia do Brasil?", opcoes:["1822","1889","1500","1808"], correta:0}
  ],
  "geografia":[
    {pergunta:"Maior paÃ­s do mundo?", opcoes:["China","RÃºssia","Brasil","CanadÃ¡"], correta:1}
  ],
  "artes":[
    {pergunta:"Quem pintou a Mona Lisa?", opcoes:["Van Gogh","Da Vinci","Picasso","Monet"], correta:1}
  ]
};

let pinGerado, categoriaEscolhida, perguntaIndex=0;
let nome="", pontos=0;
let tempo=15, timerInterval=null;
let playerRespondido=false;

// Telas
function mostrarTela(tela){
  document.getElementById("telaInicial").style.display="none";
  document.getElementById("hostTela").style.display = (tela==='host') ? "block" : "none";
  document.getElementById("playerTela").style.display = (tela==='player') ? "block" : "none";
  if(tela==='host'){
    const select = document.getElementById("categoria");
    select.innerHTML="";
    Object.keys(perguntas).forEach(cat=>{
      const option = document.createElement("option");
      option.value=cat;
      option.textContent=cat.charAt(0).toUpperCase()+cat.slice(1);
      select.appendChild(option);
    });
  }
}

// Criar partida
function criarJogo(){
  categoriaEscolhida = document.getElementById("categoria").value;
  pinGerado = Math.floor(100000 + Math.random()*900000);
  document.getElementById("pin").innerText = "PIN: "+pinGerado;
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json', {
    method:'PUT',
    body: JSON.stringify({categoria:categoriaEscolhida, perguntaIndex:0, tempo:15, jogadores:{}})
  }).then(()=> atualizarLobby());
}

// Lobby host
function atualizarLobby(){
  const lobby = document.getElementById("lobby");
  setInterval(()=>{
    fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores.json')
    .then(r=>r.json())
    .then(data=>{
      lobby.innerHTML="<h3>Jogadores no lobby:</h3>";
      if(data) Object.keys(data).forEach(j=> lobby.innerHTML+="<p>ğŸ® "+j+"</p>");
    });
  },1000);
}

// Iniciar jogo host
function iniciarJogo(){
  perguntaIndex=0;
  atualizarPerguntaHost();
}

// Atualizar pergunta host
function atualizarPerguntaHost(){
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json')
  .then(r=>r.json())
  .then(game=>{
    if(!game) return;
    if(perguntaIndex>=perguntas[categoriaEscolhida].length){ mostrarRankingFinal(); return; }
    tempo=15;
    playerRespondido=false;
    const p = perguntas[categoriaEscolhida][perguntaIndex];
    const divO = document.getElementById("opcoes");
    const divP = document.getElementById("pergunta");
    const feedback = document.getElementById("feedback");
    divP.innerText = p.pergunta;
    feedback.innerText = "";
    divO.innerHTML="";
    p.opcoes.forEach((op,i)=>{
      const btn = document.createElement("button");
      btn.className="opcaoBtn";
      btn.innerText = op;
      btn.onclick = ()=>responderHost(i);
      divO.appendChild(btn);
    });
    document.getElementById("perguntaArea").style.display="block";
    iniciarTimerHost();
  });
}

// Timer host
function iniciarTimerHost(){
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    if(!playerRespondido){
      document.getElementById("timer").innerText = "â± "+tempo+"s";
      fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json', {
        method:'PATCH',
        body: JSON.stringify({tempo})
      });
      tempo--;
      if(tempo<0){
        clearInterval(timerInterval);
        avancarPergunta();
      }
    }
  },1000);
}

// Host responde
function responderHost(opIndex){
  if(playerRespondido) return;
  playerRespondido=true;
  const p = perguntas[categoriaEscolhida][perguntaIndex];
  const feedback = document.getElementById("feedback");
  feedback.innerText = (opIndex===p.correta) ? "âœ… Acertou!" : "âŒ Errou!";
  feedback.className = "feedback " + ((opIndex===p.correta) ? "acerto" : "erro");
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores.json')
  .then(r=>r.json())
  .then(data=>{
    if(data){
      Object.keys(data).forEach(j=>{
        let pts = data[j].pontos || 0;
        if(opIndex===p.correta) pts += 10 + tempo;
        fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores/'+j+'.json', {
          method:'PATCH',
          body: JSON.stringify({pontos:pts})
        });
      });
    }
    setTimeout(avancarPergunta,1000);
  });
}

// AvanÃ§ar pergunta
function avancarPergunta(){
  perguntaIndex++;
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json', {
    method:'PATCH',
    body: JSON.stringify({perguntaIndex, tempo:15})
  }).then(()=> atualizarPerguntaHost());
}

// Player entra
function entrar(){
  nome = document.getElementById("nome").value;
  const pinInput = document.getElementById("pinInput").value;
  if(!nome || !pinInput){ alert("Digite PIN e nome!"); return; }
  pinGerado = pinInput;
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores/'+nome+'.json', {method:'PUT', body:JSON.stringify({pontos:0})})
  .then(()=>{
    document.getElementById("pinDiv").style.display="none";
    document.getElementById("playerTela").querySelector("button").style.display="none";
    atualizarPerguntaPlayer();
  });
}

// Atualizar pergunta player ao vivo
function atualizarPerguntaPlayer(){
  const divO = document.getElementById("opcoesPlayer");
  const divP = document.getElementById("perguntaPlayer");
  const divT = document.getElementById("timerPlayer");
  const feedback = document.getElementById("feedbackPlayer");
  setInterval(()=>{
    fetch(FIREBASE_URL+'partidas/'+pinGerado+'.json')
    .then(r=>r.json())
    .then(game=>{
      if(!game) return;
      categoriaEscolhida = game.categoria;
      perguntaIndex = game.perguntaIndex;
      tempo = game.tempo;
      if(perguntaIndex>=perguntas[categoriaEscolhida].length){ mostrarRankingFinal(); return; }
      const p = perguntas[categoriaEscolhida][perguntaIndex];
      divP.innerText = p.pergunta;
      feedback.innerText = "";
      divO.innerHTML="";
      p.opcoes.forEach((op,i)=>{
        const btn = document.createElement("button");
        btn.className="opcaoBtn";
        btn.innerText=op;
        btn.onclick = ()=>responderPlayer(i);
        divO.appendChild(btn);
      });
      divT.innerText = "â± "+tempo+"s";
      document.getElementById("perguntaAreaPlayer").style.display="block";
    });
  },1000);
}

// Player responde
function responderPlayer(opIndex){
  const feedback = document.getElementById("feedbackPlayer");
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores/'+nome+'.json')
  .then(r=>r.json())
  .then(data=>{
    let pts = data.pontos || 0;
    const p = perguntas[categoriaEscolhida][perguntaIndex];
    if(opIndex===p.correta){
      pts += 10 + tempo;
      feedback.innerText = "âœ… Acertou!";
      feedback.className = "feedback acerto";
    } else{
      feedback.innerText = "âŒ Errou!";
      feedback.className = "feedback erro";
    }
    fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores/'+nome+'.json', {method:'PATCH', body:JSON.stringify({pontos:pts})});
  });
}

// Ranking final
function mostrarRankingFinal(){
  document.getElementById("perguntaArea").style.display="none";
  document.getElementById("hostTela").style.display="none";
  document.getElementById("playerTela").style.display="none";
  const divR = document.getElementById("ranking");
  divR.style.display="block";
  divR.innerHTML="<h2>ğŸ† Ranking Final ğŸ†</h2>";
  fetch(FIREBASE_URL+'partidas/'+pinGerado+'/jogadores.json')
  .then(r=>r.json())
  .then(data=>{
    const lista=[];
    if(data) Object.keys(data).forEach(j=> lista.push({nome:j, score:data[j].pontos}));
    lista.sort((a,b)=>b.score-a.score);
    lista.forEach((p,i)=>{
      let medalha="";
      if(i===0) medalha="ğŸ¥‡";
      else if(i===1) medalha="ğŸ¥ˆ";
      else if(i===2) medalha="ğŸ¥‰";
      divR.innerHTML+="<p><span class='medalha'>"+medalha+"</span>"+p.nome+" - "+p.score+" pts</p>";
    });
  });
}
</script>

</body>
</html>

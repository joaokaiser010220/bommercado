<script>
  const nomeUsuarioEl = document.getElementById('nomeUsuario');
  const logoutBtn = document.getElementById('logoutBtn');
  const materiasFavoritasEl = document.getElementById('materiasFavoritas');
  const materiasOutrasEl = document.getElementById('materiasOutras');
  const modalNiveis = document.getElementById('modalNiveis');
  const tituloModal = document.getElementById('tituloModal');
  const listaNiveis = document.getElementById('listaNiveis');
  const btnFecharModal = document.getElementById('btnFecharModal');

  let materiaSelecionada = null;

  // Fun√ß√£o para abrir um n√≠vel
  function abrirNivel(materia, nivel) {
    // Exemplo: nivel1HIS.html
    const slug = materia.slug.toUpperCase();
    const url = `nivel${nivel}${slug}.html`;
    window.location.href = url;
  }

  // Fechar modal
  btnFecharModal.onclick = () => {
    modalNiveis.classList.remove('active');
  };
  // Fechar modal ao clicar fora do conte√∫do
  modalNiveis.onclick = e => {
    if (e.target === modalNiveis) {
      modalNiveis.classList.remove('active');
    }
  };

  // Mostrar notifica√ß√µes, se quiser criar

  // Montar n√≠veis
  function montarListaNiveis(materia) {
    listaNiveis.innerHTML = '';
    for (let i = 1; i <= 10; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.title = `N√≠vel ${i}`;
      btn.setAttribute('aria-label', `Ir para n√≠vel ${i} de ${materia.nome}`);
      btn.tabIndex = 0;
      btn.onclick = () => abrirNivel(materia, i);

      // Aqui poderia ser implementada l√≥gica para bloquear n√≠veis futuros
      // Por exemplo, bloquear n√≠veis acima do n√≠vel que o usu√°rio est√°.
      // Por enquanto, todos liberados.

      listaNiveis.appendChild(btn);
    }
  }

  // Mostrar mat√©rias na tela
  function mostrarMaterias(usuario) {
    materiasFavoritasEl.innerHTML = '';
    materiasOutrasEl.innerHTML = '';

    // Materias do usu√°rio: pode ser string (uma s√≥) ou array
    let favoritas = [];
    if (Array.isArray(usuario.materias)) favoritas = usuario.materias;
    else if (typeof usuario.materia === 'string') favoritas = [usuario.materia];

    // Mat√©rias favoritas
    favoritas.forEach(nomeMateria => {
      const mat = todasMaterias.find(m => m.nome.toLowerCase() === nomeMateria.toLowerCase());
      if (mat) materiasFavoritasEl.appendChild(criarCardMateria(mat));
    });

    // Outras mat√©rias (que n√£o est√£o nas favoritas)
    todasMaterias.forEach(mat => {
      if (!favoritas.some(fav => fav.toLowerCase() === mat.nome.toLowerCase())) {
        materiasOutrasEl.appendChild(criarCardMateria(mat));
      }
    });
  }

  // Logout
  logoutBtn.onclick = () => {
    localStorage.removeItem('usuarioLogado');
    window.location.href = 'login.html'; // ajustar conforme seu arquivo de login
  };

  // Inicializa√ß√£o da p√°gina
  function init() {
    const usuario = getUsuarioLogado();
    if (!usuario) {
      window.location.href = 'login.html';
      return;
    }
    nomeUsuarioEl.textContent = `Ol√°, ${usuario.nome}!`;
    mostrarMaterias(usuario);
  }

  // Rodar init ao carregar a p√°gina
  window.onload = init;
<script>
  // Dados exemplo mat√©rias (voc√™ pode atualizar para pegar do Firebase)
  const todasMaterias = [
    { nome: 'Matem√°tica', icone: '‚ûó', slug: 'MAT' },
    { nome: 'Portugu√™s', icone: 'üìö', slug: 'POR' },
    { nome: 'Hist√≥ria', icone: 'üè∞', slug: 'HIS' },
    { nome: 'Geografia', icone: 'üåç', slug: 'GEO' },
    { nome: 'Artes', icone: 'üé®', slug: 'ART' },
  ];

  const nomeUsuarioEl = document.getElementById('nomeUsuario');
  const logoutBtn = document.getElementById('logoutBtn');
  const materiasFavoritasEl = document.getElementById('materiasFavoritas');
  const materiasOutrasEl = document.getElementById('materiasOutras');
  const modalNiveis = document.getElementById('modalNiveis');
  const tituloModal = document.getElementById('tituloModal');
  const listaNiveis = document.getElementById('listaNiveis');
  const btnFecharModal = document.getElementById('btnFecharModal');

  let materiaSelecionada = null;

  // Fun√ß√£o para obter usu√°rio logado do localStorage
  function getUsuarioLogado() {
    const str = localStorage.getItem('usuarioLogado');
    if (!str) return null;
    try {
      return JSON.parse(str);
    } catch {
      return null;
    }
  }

  // Fun√ß√£o para criar card de mat√©ria
  function criarCardMateria(materia) {
    const div = document.createElement('div');
    div.className = 'materia-card';
    div.tabIndex = 0;
    div.setAttribute('role', 'button');
    div.setAttribute('aria-pressed', 'false');
    div.title = `Abrir n√≠veis de ${materia.nome}`;
    div.innerHTML = `<div class="materia-icone" aria-hidden="true">${materia.icone}</div>
                     <div class="materia-nome">${materia.nome}</div>`;
    div.onclick = () => abrirModalNiveis(materia);
    div.onkeydown = e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        abrirModalNiveis(materia);
      }
    };
    return div;
  }

  // Fun√ß√£o para abrir o modal de n√≠veis
  function abrirModalNiveis(materia) {
    materiaSelecionada = materia;
    tituloModal.textContent = `N√≠veis de ${materia.nome}`;
    montarListaNiveis(materia);
    modalNiveis.classList.add('active');
  }

  // Montar lista dos n√≠veis no modal
  function montarListaNiveis(materia) {
    listaNiveis.innerHTML = '';
    for (let i = 1; i <= 10; i++) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.title = `N√≠vel ${i}`;
      btn.setAttribute('aria-label', `Ir para n√≠vel ${i} de ${materia.nome}`);
      btn.tabIndex = 0;
      btn.onclick = () => abrirNivel(materia, i);
      listaNiveis.appendChild(btn);
    }
  }

  // Abrir p√°gina do n√≠vel espec√≠fico
  function abrirNivel(materia, nivel) {
    const slug = materia.slug.toUpperCase();
    const url = `nivel${nivel}${slug}.html`;
    window.location.href = url;
  }

  // Mostrar mat√©rias na tela, separando favoritas e outras
  function mostrarMaterias(usuario) {
    materiasFavoritasEl.innerHTML = '';
    materiasOutrasEl.innerHTML = '';

    let favoritas = [];
    if (Array.isArray(usuario.materias)) favoritas = usuario.materias;
    else if (typeof usuario.materia === 'string') favoritas = [usuario.materia];

    favoritas.forEach(nomeMateria => {
      const mat = todasMaterias.find(m => m.nome.toLowerCase() === nomeMateria.toLowerCase());
      if (mat) materiasFavoritasEl.appendChild(criarCardMateria(mat));
    });

    todasMaterias.forEach(mat => {
      if (!favoritas.some(fav => fav.toLowerCase() === mat.nome.toLowerCase())) {
        materiasOutrasEl.appendChild(criarCardMateria(mat));
      }
    });
  }

  // Logout do usu√°rio
  logoutBtn.onclick = () => {
    localStorage.removeItem('usuarioLogado');
    window.location.href = 'login.html'; // ajuste o caminho se necess√°rio
  };

  // Inicializa a p√°gina
  function init() {
    const usuario = getUsuarioLogado();
    if (!usuario) {
      window.location.href = 'login.html';
      return;
    }
    nomeUsuarioEl.textContent = `Ol√°, ${usuario.nome}!`;
    mostrarMaterias(usuario);
  }

  // Fechar modal ao clicar no bot√£o ou fora do conte√∫do
  btnFecharModal.onclick = () => {
    modalNiveis.classList.remove('active');
  };
  modalNiveis.onclick = e => {
    if (e.target === modalNiveis) {
      modalNiveis.classList.remove('active');
    }
  };

  window.onload = init;
</script>
</body>
</html>
